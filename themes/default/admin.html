<!DOCTYPE html>
<html>

<head>
    <title id="title"></title>
    <link rel="stylesheet" type="text/css" href="static/style.css">
    <link rel="stylesheet" type="text/css" href="static/fonts.css">
    <script src="static/js-yaml.min.js"></script>
    <script src="static/showdown.min.js"></script>
    <link rel="icon" type="image/svg" href="static/img/logo.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.js"
        integrity="sha512-GoORoNnxst42zE3rYPj4bNBm0Q6ZRXKNH2D9nEmNvVF/z24ywVnijAWVi/09iBiVDQVf3UlZHpzhAJIdd9BXqw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ext-language_tools.min.js"
        integrity="sha512-8qx1DL/2Wsrrij2TWX5UzvEaYOFVndR7BogdpOyF4ocMfnfkw28qt8ULkXD9Tef0bLvh3TpnSAljDC7uyniEuQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/mode-markdown.min.js"
        integrity="sha512-8euv05RhbuOcZWj/kpF+KtKN7g1CPx7buTZjIBf/rZQz47cduH3DERWoqJFrIYE0TzaIlptz+Ir2BodrmLT8kQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/theme-tomorrow_night_eighties.min.js"
        integrity="sha512-ZpoDdz3A/zV2aKTjH8fcyDKhg+zOuu423OkuJ7SvK1jMRZUSkTtH1YQQS10pqNvi9CYT2jmtOCxuNQW9TEtHdw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<top id="top" />

<body>
    <div class="menu">
        <a href="index.html" class="menuBtn title" id="titlebtn"></a>
        <a class="menuBtn" href="blog.html">Blog</a>
        <a class="menuBtn" href="about.html">About</a>
    </div>

    <script>
        fetch('settings.yaml')
            .then(response => response.text())
            .then(data => {
                // Do something with your data
                var doc = jsyaml.load(data);
                document.getElementsByTagName("footer")[0].innerHTML = doc.settings.copyright_info;
                document.getElementById("title").innerHTML = doc.settings.site_name;
                document.getElementById("titlebtn").innerHTML = doc.settings.site_name;
            });
    </script>

    <div class="filesbar" id="filePanel" data-open="false">
        <details id="postlist">
            <summary>
                <h2 style="display: inline;">Posts</h2>
            </summary>

        </details>
        <label for="name">Name:</label>
        <input type="text" id="name" value="name"><br><br>

        <label for="author">Author:</label>
        <input type="text" id="author" value="author"><br><br>

        <label for="date">Date:</label>
        <input type="text" id="date" value="date"><br><br>

        <label for="featured_image">Featured Image:</label>
        <input type="text" id="featured_image" value="featured_image"><br><br>


        <a href="#" id="openclose" onclick="togglePanel();">
            ◀
        </a>
        <a target="_blank" id="exportYaml">Export yaml</a>
    </div>

    <div class="editorcontainer">
        <div id="pane-left">
            <div class="ace-editor" id="editor" style="height: 100%; width: 100%;">Hello world!</div>
        </div>
        <div id="pane-right">

        </div>

    </div>


</body>

<script>
    const postlist = document.querySelector("#postlist");
    const panel = document.querySelector("#filePanel");
    const openclose = document.querySelector("#openclose");
    var postsObj = null;

    fetch('posts.yaml')
        .then(response => response.text())
        .then(data => {
            // Do something with your data
            postsObj = jsyaml.load(data);
            for (const post of postsObj.posts) {
                var postbutton = document.createElement('a');
                postbutton.className = "markBtn";
                postbutton.setAttribute("onClick", `loadPost('${post.name}');`)
                postbutton.href = "#";
                postbutton.innerHTML = `${post.name}`;
                postlist.appendChild(postbutton);
            }
        });
    
    function loadPost(postName) {
        for (const post of postsObj.posts) {
            if (postName == post.name) {
                document.getElementById("name").value = post.name;
                document.getElementById("author").value = post.author;
                document.getElementById("date").value = post.date;
                document.getElementById("featured_image").value = post.featured_image;
                editor.getSession().setValue(post.content);
            }
        }
    }

    function togglePanel() {
        if (panel.dataset.open == "true") {
            panel.dataset.open = "false";
            openclose.innerHTML = "▶";
        } else {
            panel.dataset.open = "true";
            openclose.innerHTML = "◀";
        }
    }

    var element = document.getElementById("editor");
    var editor = ace.edit(element, {
        mode: "ace/mode/markdown",
        theme: "ace/theme/tomorrow_night_eighties",
        printMargin: false,
        fontSize: "13pt",
        behavioursEnabled: true,
        wrap: true,
        selectionStyle: "text"
    });
    editor.resize();

    var rightPane = document.getElementById("pane-right");

    var innerpane = document.createElement("div");
    innerpane.innerHTML = `rel
                <div class="landing preview">
                    <div class="jumbo" id="featuredImg" style="background-image: url('');"></div>
                    <div class="innerLanding" style="margin-top: -5pt;">
                        <h1>Title</h1>
                        HTML
                    </div>
                    <p class="published">Published</p>
                </div>
                `;
    rightPane.appendChild(innerpane);

    setInterval(render, 100);
    var markdown = "";
    var converter = new showdown.Converter();

    var name = "";
    var author = "";
    var date = "";
    var featured_image = "";
    var postsYaml = "";
    
    function render() {
        name = document.getElementById("name").value;
        author = document.getElementById("author").value;
        date = document.getElementById("date").value;
        featured_image = document.getElementById("featured_image").value;

        markdown = editor.getValue();
        var markdown_html = converter.makeHtml(markdown);

        if (featured_image == "none") {
            var img = "";
        }
        else {
            var img = `<div class="jumbo" style="background-image: url('${featured_image}');"></div>`
        }

        document.getElementById("pane-right").innerHTML = `
        <div class="landingPreview">
            ${img}
            <div class="innerLanding" style="margin-top: -5pt;">
                <h1>${name}</h1>
                    ${markdown_html}
            </div>
            <p class="published">Published ${date} by ${author}</p>
        </div>
        `;

        postsYaml = jsyaml.dump(postsObj);
        postsYaml = btoa(postsYaml);

        document.getElementById("exportYaml").setAttribute("href", `data:text/plain;base64,${postsYaml}`);
    }
    
</script>

<footer>
</footer>

</html>